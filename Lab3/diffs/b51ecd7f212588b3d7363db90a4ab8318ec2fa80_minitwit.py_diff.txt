@@ -82,11 +82,10 @@ def before_request():
                           [session['user_id']], one=True)
 
 
-@app.after_request
-def after_request(response):
+@app.teardown_request
+def teardown_request(exception):
     """Closes the database again at the end of the request."""
     g.db.close()
-    return response
 
 
 @app.route('/')
