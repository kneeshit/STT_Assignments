(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{88289:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/analytics",function(){return s(42532)}])},14197:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return M}});var t=s(39324),n=s(4337),i=s(35250),r=s(16266),l=s(19841),c=s(60554),o=s(70079),d=s(1454),u=s(32004),f=s(94968),x=s(21389),g=s(6038),m=s(52696),h=s(75641),p=s(88327),v=s(15329),y=s(1821),b=s(82277),j=s(13090),k=s(78931);function w(){var e=(0,n._)(["max-w-5xl mx-auto w-full"]);return w=function(){return e},e}function N(e){var a=e.route,s=e.children,t=(0,c.useRouter)();return(0,i.jsx)(v.ZB,{$as:"button",className:(0,l.default)("rounded",t.route===a?"bg-gray-700":"hover:bg-gray-800"),onClick:function(){t.push(a)},children:s})}function _(e){var a=e.workspaceName,s=e.hasAdminPrivileges,n=(0,c.useRouter)(),l=(0,o.useCallback)(function(){n.push("/")},[n]);return(0,i.jsxs)("nav",{className:"p-2",children:[(0,i.jsxs)("div",{className:"mb-1 flex flex-row gap-2",children:[(0,i.jsxs)(j.MP,{onClick:l,children:[(0,i.jsx)(p.ZP,{icon:d.Ao2}),(0,i.jsx)(u.Z,(0,t._)({},A.backToChat))]}),(0,i.jsx)(j.H,{})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 py-2",children:[(0,i.jsxs)("div",{className:"my-2 flex flex-col gap-2 px-2",children:[(0,i.jsx)(g.B0,{size:"large"}),(0,i.jsx)("h2",{className:"text-lg text-gray-100",children:a})]}),(0,i.jsxs)(N,{route:"/admin",children:[(0,i.jsx)(p.ZP,{icon:r.Z}),(0,i.jsx)(u.Z,(0,t._)({},A.membersPageTitle))]}),!0===s?(0,i.jsxs)(N,{route:"/admin/analytics",children:[(0,i.jsx)(p.ZP,{icon:d.orK}),(0,i.jsx)(u.Z,(0,t._)({},A.analytics))]}):null]})]})}function M(e){var a,s=e.mobilePageTitle,n=e.requireAdminPrivileges,r=void 0!==n&&n,l=e.children,d=(0,k.ec)(function(e){return e.currentWorkspace}),f=(0,k.$T)(),x=(0,m.Ix)(d),g=(0,c.useRouter)(),p=null!=d?(a=d.role)===h.r3.ADMIN||a===h.r3.OWNER:void 0;return(0,o.useEffect)(function(){r&&!1===p&&g.push("/admin")},[r,p,g]),(0,i.jsx)(b.Z,{showNavigation:!0,renderTitle:s,renderSidebar:(0,i.jsx)(_,{workspaceName:f?"":x,hasAdminPrivileges:p}),children:(0,i.jsxs)(L,{children:[f&&(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsx)(y.Z,{})}),!f&&!d&&(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsx)(u.Z,(0,t._)({},A.workspaceNotFound))}),!f&&d&&l]})})}var L=x.Z.div(w()),A=(0,f.vU)({workspaceNotFound:{id:"adminPage.workspaceNotFound",defaultMessage:"Workspace not found",description:"The title of the admin page."},backToChat:{id:"adminPage.backToChat",defaultMessage:"Back to chat",description:"Navigation button to return to main chat page"},membersPageTitle:{id:"adminPage.membersPageTitle",defaultMessage:"Members",description:"The title of the members page"},analytics:{id:"adminPage.analytics",defaultMessage:"Analytics",description:"Analytics sidebar item"}})},42532:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return P},default:function(){return T}});var t=s(39324),n=s(35250),i=s(21722),r=s(22830),l=s(75883),c=s(5268),o=s(65998),d=s(73413),u=s.n(d),f=s(70079),x=s(25771),g=s(70671),m=s(32004),h=s(94968),p=s(62509),v=s(99486),y=s(1821);function b(e){return j.apply(this,arguments)}function j(){return(j=(0,i._)(function(e){var a,s,t,n;return(0,l.Jh)(this,function(i){return(a=(0,r._)(e.queryKey,2))[0],t=(s=a[1]).workspaceId,n=s.accessToken,[2,v.ZP.getWorkspaceAnalytics(n,t)]})})).apply(this,arguments)}o.kL.register(o.uw,o.f$,o.od,o.jn,o.Dx,o.u,o.De);var k={BLUE:"#3a88ff",ORANGE:"#ff8052"};function w(e){var a=e.dailyData,s=(0,g.Z)(),t=(0,f.useMemo)(function(){return function(e,a){for(var s=function(a,s){var t;return null===(t=e.find(function(e){return new Date(e.date).toLocaleDateString()===a}))||void 0===t?void 0:t[s]},t=new Date(e[0].date),n=new Date(e[e.length-1].date),i=[],r=new Date(t);r<=n;r.setDate(r.getDate()+1))i.push(new Date(r).toLocaleDateString());return{labels:i,datasets:[{label:a.formatMessage(L.dailyMessagesLabel),data:i.map(function(e){return s(e,"message_count")}),borderColor:k.BLUE,fill:!1},{label:a.formatMessage(L.dailyUsersLabel),data:i.map(function(e){return s(e,"active_users_count")}),borderColor:k.ORANGE,fill:!1}]}}(a,s)},[a,s]);return(0,n.jsx)("div",{children:(0,n.jsx)(x.x1,{data:t,options:{animation:{duration:0},scales:{y:{beginAtZero:!0}}}})})}function N(e){var a=e.label,s=e.value;return(0,n.jsxs)("div",{className:"w-1/3 rounded bg-gray-50 px-4 py-2",children:[(0,n.jsx)("label",{className:"text-sm text-gray-600",children:a}),(0,n.jsx)("div",{className:"text-xl font-medium text-gray-800",children:s})]})}function _(e){var a=e.data,s=(0,g.Z)();return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-lg text-gray-800",children:(0,n.jsx)(m.Z,(0,t._)({},L.totals))}),(0,n.jsxs)("div",{className:"mb-12 flex gap-2",children:[(0,n.jsx)(N,{label:s.formatMessage(L.usersLabel),value:a.total_users}),(0,n.jsx)(N,{label:s.formatMessage(L.conversationsLabel),value:a.total_conversations}),(0,n.jsx)(N,{label:s.formatMessage(L.messagesLabel),value:a.total_messages})]}),a.daily_data.length>0?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-lg text-gray-800",children:(0,n.jsx)(m.Z,(0,t._)({},L.dailyUsage))}),(0,n.jsx)(w,{dailyData:a.daily_data})]}):null]})}function M(e){var a,s=e.currentWorkspaceId,i=(0,g.Z)(),r=(a=(0,p.kP)().session,(0,c.a)(["workspace-analytics",{workspaceId:s,accessToken:null==a?void 0:a.accessToken}],b,{enabled:(null==a?void 0:a.accessToken)!=null})).data;return(0,n.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-8",children:[(0,n.jsx)(u(),{children:(0,n.jsx)("title",{children:i.formatMessage(L.title)})}),(0,n.jsx)("div",{className:"mb-6 text-2xl font-medium text-gray-800",children:(0,n.jsx)(m.Z,(0,t._)({},L.title))}),void 0!==r?(0,n.jsx)(_,{data:r}):(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(y.Z,{})})]})}var L=(0,h.vU)({title:{id:"workspaceAnalytics.title",defaultMessage:"Analytics",description:"Title of analytics page"},totals:{id:"workspaceAnalytics.totals",defaultMessage:"Totals",description:"Section header of total analytics"},usersLabel:{id:"workspaceAnalytics.usersLabel",defaultMessage:"Users",description:"Label of total user count"},conversationsLabel:{id:"workspaceAnalytics.conversationsLabel",defaultMessage:"Conversations",description:"Label of total conversations count"},messagesLabel:{id:"workspaceAnalytics.messagesLabel",defaultMessage:"Messages",description:"Label of total messages count"},dailyUsage:{id:"workspaceAnalytics.dailyUsage",defaultMessage:"Daily Usage",description:"Title of daily usage chart"},dailyMessagesLabel:{id:"workspaceAnalytics.dailyMessagesLabel",defaultMessage:"Messages",description:"Label of daily messages in chart"},dailyUsersLabel:{id:"workspaceAnalytics.dailyUsersLabel",defaultMessage:"Users",description:"Label of daily users in chart"}}),A=s(14197),P=!0;function T(e){return(0,n.jsx)(M,(0,t._)({},e))}T.getLayout=function(e){return(0,n.jsx)(A.default,{mobilePageTitle:"Analytics",requireAdminPrivileges:!0,children:e})}}},function(e){e.O(0,[2798,6835,8983,4930,6493,9774,2888,179],function(){return e(e.s=88289)}),_N_E=e.O()}]);